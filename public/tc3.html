<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>TechCrunch</title>
        <style type="text/css" media="screen">@import "jqtouch-dz/jqtouch/jqtouch.css";</style>
        <style type="text/css" media="screen">@import "jqtouch-dz/themes/apple/theme.css";</style>
        <style type="text/css" media="screen">@import "jqtouch-dz/extensions/jqt.bars/jqt.bars.css";</style>

        <script src="jquery-1.5.1.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="jqtouch-dz/jqtouch/jqtouch.js" type="application/x-javascript" charset="utf-8"></script>
        <!-- for scrolling -->
        <script src="jqtouch-dz/extensions/jqt.bars/jqt.bars.js" type="application/x-javascript" charset="utf-8"></script>
        
        <script src="techcrunchapp.js" type="text/javascript"></script>
        
        <script type="text/javascript" charset="utf-8">
            var jQT = new $.jQTouch({
                icon: 'jqtouch.png',
                icon4: 'jqtouch4.png',
                addGlossToIcon: false,
                startupScreen: 'jqt_startup.png',
                statusBar: 'black',
                preloadImages: [
                    'jqtouch-dz/themes/jqt/img/activeButton.png',
                    'jqtouch-dz/themes/jqt/img/back_button.png',
                    'jqtouch-dz/themes/jqt/img/back_button_clicked.png',
                    'jqtouch-dz/themes/jqt/img/blueButton.png',
                    'jqtouch-dz/themes/jqt/img/button.png',
                    'jqtouch-dz/themes/jqt/img/button_clicked.png',
                    'jqtouch-dz/themes/jqt/img/grayButton.png',
                    'jqtouch-dz/themes/jqt/img/greenButton.png',
                    'jqtouch-dz/themes/jqt/img/redButton.png',
                    'jqtouch-dz/themes/jqt/img/whiteButton.png',
                    'jqtouch-dz/themes/jqt/img/loading.gif'
                    ],
                useFastTouch: true    
            });
            // Some sample Javascript functions:
            $(function(){
                // Show a swipe event on swipe test
                $('#swipeme').swipe(function(evt, data) {
                    $(this).html('You swiped <strong>' + data.direction + '/' + data.deltaX +':' + data.deltaY + '</strong>!');
                    $(this).parent().after('<li>swiped!</li>')

                });
                $('#tapme').tap(function(){
                    $(this).parent().after('<li>tapped!</li>')
                })

                // Page animation callback events
                $('#pageevents').
                    bind('pageAnimationStart', function(e, info){ 
                        $(this).find('.info').append('Started animating ' + info.direction + '&hellip; ');
                    }).
                    bind('pageAnimationEnd', function(e, info){
                        $(this).find('.info').append(' finished animating ' + info.direction + '.<br /><br />');
                    });
                // Page animations end with AJAX callback event, example 1 (load remote HTML only first time)
                $('#callback').bind('pageAnimationEnd', function(e, info){
                    // Make sure the data hasn't already been loaded (we'll set 'loaded' to true a couple lines further down)
                    if (!$(this).data('loaded')) {
                        // Append a placeholder in case the remote HTML takes its sweet time making it back
                        // Then, overwrite the "Loading" placeholder text with the remote HTML
                        $(this).append($('<div>Loading</div>').load('ajax.html .info', function() {        
                            // Set the 'loaded' var to true so we know not to reload
                            // the HTML next time the #callback div animation ends
                            $(this).parent().data('loaded', true);  
                        }));
                    }
                });
                // Orientation callback event
                $('#jqt').bind('turn', function(e, data){
                    $('#orient').html('Orientation: ' + data.orientation);
                });
                
            });
        </script>
        <style type="text/css" media="screen">
            #jqt.fullscreen #home .info {
                display: none;
            }
            div#jqt #about {
                padding: 100px 10px 40px;
                text-shadow: rgba(255, 255, 255, 0.3) 0px -1px 0;
                font-size: 13px;
                text-align: center;
                background: #161618;
            }
            div#jqt #about p {
                margin-bottom: 8px;
            }
            div#jqt #about a {
                color: #fff;
                font-weight: bold;
                text-decoration: none;
            }
            div#jqt #story-content {
              background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#FFFFFF), to(#EDEDED));
            }
        </style>
    </head>
    <body>
        <div id="jqt">
            <div id="home" class="current">
                <div class="toolbar">
                    <h1>TechCrunch</h1>
                    <a class="button flip" id="infoButton" href="#about">About</a>
                </div>
                <div id="stories" class="s-scrollwrapper" momentum="true" vScrollbar="false">
                  <ul id="posts" class="edgetoedge">
                      <!--li class="sep">F</li>
                      <li><a href="#">Flintstone, <em>Fred</em></a></li>
                      <li><a href="#">Flintstone, <em>Pebble</em></a></li>
                      <li><a href="#">Flintstone, <em>Wilma</em></a></li>
                      <li class="sep">J</li>
                      <li><a href="#">Jetson, <em>Elroy</em></a></li>
                      <li><a href="#">Jetson, <em>George</em></a></li>
                      <li><a href="#">Jetson, <em>Jane</em></a></li>
                      <li><a href="#">Jetson, <em>Judy</em></a></li>
                      <li class="sep">R</li>
                      <li><a href="#">Rubble, <em>Bambam</em></a></li>
                      <li><a href="#">Rubble, <em>Barney</em></a></li>
                      <li><a href="#">Rubble, <em>Betty</em></a></li-->
                  </ul>
                </div>
            </div>
            <div id="about" class="selectable">
                    <p><img src="jqtouch.png" /></p>
                    <p><strong>H5 TechCrunch App<br />Version 0.1 beta</strong><br />
                    <p><br /><br /><a href="#" class="grayButton goback">Close</a></p>
            </div>
            
            <div id="fullstory">
              <div class="toolbar">
                  <h1 id="story-title" style="font-size:0.8em;white-space:normal;width:180px;top:4px"></h1>
                  <a href="#" class="back">Back</a>
              </div>
              <div class="s-scrollwrapper">
                <ul class="rounded">
                  <li id="story-content" style="color:black;font-weight:normal;font-size:0.9em;margin-bottom:35px"></li>
                </ul>
              </div>
            </div>
            
            <div id="metal">
              <div class="toolbar">
                <h1></h1>
                <a href="#" class="back"></a>
              </div>
              <div class="s-scrollwrapper">
                <div>
                  <ul class="metal">
                    <li class="arrow"><a href="#"><small>AM</small> 9:40 <em>Buenos Aires</em></a></li>
                    <li class="arrow"><a href="#"><small>PM</small> 19:40 <em>Singapur</em></a></li>
                    <li class="arrow"><a href="#"><small>PM</small> 22:40 <em>Japan</em></a></li>
                    <li class="arrow"><a href="#"><small>PM</small> 11:40 <em>New York</em></a></li>
                    <li class="arrow"><a href="#"><small>PM</small> 9:40 <em>Ontario</em></a></li>
                  </ul>
                </div>
              </div>
            </div>
            
        </div>
        <script>
          var SUPPORT_TOUCH = (typeof Touch != "undefined");
          var START_EVENT = SUPPORT_TOUCH? 'touchstart' : 'mousedown';
          var MOVE_EVENT = SUPPORT_TOUCH? 'touchmove' : 'mousemove';
          var END_EVENT = SUPPORT_TOUCH? 'touchend' : 'mouseup';
        
          var lastDate = null;
       
          function postBuilder(post) {
            var postsDiv = $('#posts');

            console.log(post.date + " - " + post.title);
            if (post.date != lastDate) {
              lastDate = post.date;
              postsDiv.append('<li class="sep">' + post.date + '</li>');
            }
            postsDiv.append('<li class="arrow" style="font-size:0.8em"><a href="#fullstory">' + post.title + '</a></li>');

            $('#posts a:last').bind(START_EVENT, function() {
              $('#story-title').html(post.title);
              $("#story-content").html(post.body);
              jQT.refresh_iScroll();
              //jQT.goTo('#fullstory');
            });
          }
          
          $(function() {
            $('#story-content').swipe(function(evt, data) {
              console.log("Swipe on story");
              jQT.goBack();
            });

            
            loadPosts([], postBuilder);
            load_tc_home(function(results) {
              loadPosts(results, postBuilder);
            });
          });
          
        </script>
    </body>
</html>